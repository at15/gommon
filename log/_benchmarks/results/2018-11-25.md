# 2018-11-25

````text
go test -run none -bench . -benchtime 3s -benchmem -memprofile p.out
goos: linux
goarch: amd64
pkg: github.com/dyweb/gommon/log/_benchmarks
BenchmarkDisabledLevelNoFormat/gommon-8         	1000000000	         6.92 ns/op	      16 B/op	       1 allocs/op
BenchmarkDisabledLevelNoFormat/gommon.F-8       	5000000000	         0.58 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/gommon.check-8   	5000000000	         0.22 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/zap-8            	500000000	        10.9 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/zap.check-8      	500000000	        11.2 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/zap.sugar-8      	500000000	         9.32 ns/op	      16 B/op	       1 allocs/op
BenchmarkDisabledLevelNoFormat/zerolog-8        	5000000000	         1.66 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/apex-8           	2000000000	         2.56 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/logrus-8         	1000000000	         6.91 ns/op	      16 B/op	       1 allocs/op
BenchmarkWithoutFieldsText/gommon-8             	30000000	       132 ns/op	     288 B/op	       3 allocs/op
BenchmarkWithoutFieldsText/gommon.F-8           	50000000	        88.2 ns/op	     160 B/op	       1 allocs/op
BenchmarkWithoutFieldsText/std-8                	10000000	       401 ns/op	     128 B/op	       2 allocs/op
BenchmarkWithoutFieldsText/zap-8                	20000000	       275 ns/op	      72 B/op	       3 allocs/op
BenchmarkWithoutFieldsText/zap.sugar-8          	20000000	       311 ns/op	     200 B/op	       5 allocs/op
BenchmarkWithoutFieldsText/zerolog-8            	 3000000	      1422 ns/op	    2011 B/op	      36 allocs/op
BenchmarkWithoutFieldsText/apex-8               	 2000000	      1538 ns/op	     320 B/op	      15 allocs/op
BenchmarkWithoutFieldsText/logrus-8             	 1000000	      3154 ns/op	     769 B/op	      15 allocs/op
BenchmarkWithoutFieldsText/klog-8               	10000000	       615 ns/op	      16 B/op	       1 allocs/op
BenchmarkWithoutFieldsTextFormat/gommon-8       	20000000	       210 ns/op	     360 B/op	       4 allocs/op
BenchmarkWithoutFieldsTextFormat/zap.sugar-8    	10000000	       369 ns/op	     241 B/op	       6 allocs/op
BenchmarkWithoutFieldsTextFormat/apex-8         	 2000000	      1944 ns/op	     488 B/op	      18 allocs/op
BenchmarkWithoutFieldsTextFormat/logrus-8       	 1000000	      4012 ns/op	    1001 B/op	      18 allocs/op
BenchmarkWithoutFieldsTextFormat/klog-8         	10000000	       634 ns/op	      24 B/op	       2 allocs/op
BenchmarkWithoutFieldsJSON/gommon-8             	50000000	       107 ns/op	     288 B/op	       3 allocs/op
BenchmarkWithoutFieldsJSON/gommon.F-8           	100000000	        63.5 ns/op	     160 B/op	       1 allocs/op
BenchmarkWithoutFieldsJSON/zap-8                	30000000	       182 ns/op	       0 B/op	       0 allocs/op
BenchmarkWithoutFieldsJSON/zap.sugar-8          	20000000	       260 ns/op	     128 B/op	       2 allocs/op
BenchmarkWithoutFieldsJSON/zerolog-8            	50000000	       116 ns/op	       0 B/op	       0 allocs/op
BenchmarkWithoutFieldsJSON/apex-8               	 2000000	      2440 ns/op	     512 B/op	      10 allocs/op
BenchmarkWithoutFieldsJSON/logrus-8             	 1000000	      3867 ns/op	    1218 B/op	      22 allocs/op
BenchmarkWithContextFieldsJSON/gommon-8         	30000000	       158 ns/op	     608 B/op	       4 allocs/op
BenchmarkWithContextFieldsJSON/gommon.F-8       	30000000	       110 ns/op	     480 B/op	       2 allocs/op
BenchmarkWithContextFieldsJSON/zap-8            	30000000	       187 ns/op	       0 B/op	       0 allocs/op
BenchmarkWithContextFieldsJSON/zap.sugar-8      	20000000	       258 ns/op	     128 B/op	       2 allocs/op
BenchmarkWithContextFieldsJSON/zerolog-8        	50000000	       113 ns/op	       0 B/op	       0 allocs/op
BenchmarkWithContextFieldsJSON/apex-8           	 1000000	      4718 ns/op	    1089 B/op	      19 allocs/op
BenchmarkWithContextFieldsJSON/logrus-8         	 1000000	      5014 ns/op	    1362 B/op	      25 allocs/op
BenchmarkNoContextWithFieldsJSON/gommon.F-8     	30000000	       128 ns/op	     608 B/op	       3 allocs/op
BenchmarkNoContextWithFieldsJSON/zap-8          	20000000	       282 ns/op	     128 B/op	       1 allocs/op
BenchmarkNoContextWithFieldsJSON/zap.sugar-8    	20000000	       296 ns/op	     256 B/op	       1 allocs/op
BenchmarkNoContextWithFieldsJSON/zerolog-8      	30000000	       123 ns/op	       0 B/op	       0 allocs/op
BenchmarkNoContextWithFieldsJSON/apex-8         	 1000000	      4123 ns/op	    1545 B/op	      23 allocs/op
BenchmarkNoContextWithFieldsJSON/logrus-8       	 1000000	      4560 ns/op	    1844 B/op	      29 allocs/op
PASS
ok  	github.com/dyweb/gommon/log/_benchmarks	228.248s
````

gommon only

````text
  make bench-gommon 
go test -run none -bench=".*/gommon" -benchtime 3s -benchmem -memprofile p.out
goos: linux
goarch: amd64
pkg: github.com/dyweb/gommon/log/_benchmarks
BenchmarkDisabledLevelNoFormat/gommon-8         	1000000000	         6.81 ns/op	      16 B/op	       1 allocs/op
BenchmarkDisabledLevelNoFormat/gommon.F-8       	5000000000	         0.57 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/gommon.check-8   	5000000000	         0.22 ns/op	       0 B/op	       0 allocs/op
BenchmarkWithoutFieldsText/gommon-8             	30000000	       129 ns/op	     288 B/op	       3 allocs/op
BenchmarkWithoutFieldsText/gommon.F-8           	50000000	        89.6 ns/op	     160 B/op	       1 allocs/op
BenchmarkWithoutFieldsTextFormat/gommon-8       	20000000	       202 ns/op	     360 B/op	       4 allocs/op
BenchmarkWithoutFieldsJSON/gommon-8             	50000000	       103 ns/op	     288 B/op	       3 allocs/op
BenchmarkWithoutFieldsJSON/gommon.F-8           	100000000	        61.9 ns/op	     160 B/op	       1 allocs/op
BenchmarkWithContextFieldsJSON/gommon-8         	30000000	       146 ns/op	     608 B/op	       4 allocs/op
BenchmarkWithContextFieldsJSON/gommon.F-8       	50000000	       103 ns/op	     480 B/op	       2 allocs/op
BenchmarkNoContextWithFieldsJSON/gommon.F-8     	30000000	       119 ns/op	     608 B/op	       3 allocs/op
PASS
ok  	github.com/dyweb/gommon/log/_benchmarks	49.553s
````

gommon, after allocating more space for fields, `.F` reduced to one alloc

````text
make bench-gommon     
go test -run none -bench=".*/gommon" -benchtime 3s -benchmem -memprofile p.out
goos: linux
goarch: amd64
pkg: github.com/dyweb/gommon/log/_benchmarks
BenchmarkDisabledLevelNoFormat/gommon-8         	1000000000	         6.91 ns/op	      16 B/op	       1 allocs/op
BenchmarkDisabledLevelNoFormat/gommon.F-8       	5000000000	         0.57 ns/op	       0 B/op	       0 allocs/op
BenchmarkDisabledLevelNoFormat/gommon.check-8   	5000000000	         0.23 ns/op	       0 B/op	       0 allocs/op
BenchmarkWithoutFieldsText/gommon-8             	30000000	       130 ns/op	     288 B/op	       3 allocs/op
BenchmarkWithoutFieldsText/gommon.F-8           	50000000	        87.4 ns/op	     160 B/op	       1 allocs/op
BenchmarkWithoutFieldsTextFormat/gommon-8       	20000000	       205 ns/op	     360 B/op	       4 allocs/op
BenchmarkWithoutFieldsJSON/gommon-8             	50000000	       101 ns/op	     288 B/op	       3 allocs/op
BenchmarkWithoutFieldsJSON/gommon.F-8           	100000000	        62.2 ns/op	     160 B/op	       1 allocs/op
BenchmarkWithContextFieldsJSON/gommon-8         	30000000	       117 ns/op	     352 B/op	       3 allocs/op
BenchmarkWithContextFieldsJSON/gommon.F-8       	50000000	        74.0 ns/op	     224 B/op	       1 allocs/op
BenchmarkNoContextWithFieldsJSON/gommon.F-8     	50000000	        92.2 ns/op	     352 B/op	       2 allocs/op
PASS
ok  	github.com/dyweb/gommon/log/_benchmarks	48.130s
````

The allocation comes from creating new slice 

````text
BenchmarkWithContextFieldsJSON/gommon.F-8       	50000000	        74.0 ns/op	     224 B/op	       1 allocs/op
BenchmarkNoContextWithFieldsJSON/gommon.F-8     	50000000	        92.2 ns/op	     352 B/op	       2 allocs/op
````

````go
    533       6.05GB    16.61GB           				logger.InfoF(msg, dlog.Fields{ 
    534            .          .           					dlog.Int("i1", 1), dlog.Str("s1", "v1"), 
````